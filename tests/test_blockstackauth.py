"""Tests for BlockstackAuth."""
import pytest
from jwt import DecodeError

from backend.blockstack_auth import BlockstackAuth

# sw2020testuser1.id.blockstack
TOKEN_1 = "eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NksifQ.eyJqdGkiOiIyNGE1OTFkNS1lOGJiLTQwMzYtYWE0Ni1hNzg5MjU2ZDVjZDYiLCJpYXQiOjE1OTEyMjUyMzIsImV4cCI6MTYyNTM1MzIzMiwiaXNzIjoiZGlkOmJ0Yy1hZGRyOjE0Z1N4eFhZdzlXbTNoYWoxaGVKYXQ1ZGdpeHF0YVJ3a3MiLCJwcml2YXRlX2tleSI6IjdiMjI2OTc2MjIzYTIyNjEzMDMwMzA2NjY0MzAzNDY2NjIzNzM0MzQzNzM5MzM2NTM2MzA2MTY1NjYzMDM4MzE2NDYzNjMzMzY1MzEzNDIyMmMyMjY1NzA2ODY1NmQ2NTcyNjE2YzUwNGIyMjNhMjIzMDMyNjYzNDYxMzMzMTYyMzA2NDY1NjY2MjM4MzkzNTM4MzY2NjY1NjIzMzM5MzY2MTYzMzE2MzYzNjYzMzYzMzg2NjY1NjM2MzM4NjM2NjMwNjMzNTM2MzMzODYxMzEzMDYzMzAzNDM4NjYzOTM1MzEzMzMwMzY2NTY1MzEzNzY1MzgyMjJjMjI2MzY5NzA2ODY1NzI1NDY1Nzg3NDIyM2EyMjM1MzAzOTM4MzMzOTM5MzQ2MzY2NjMzODMyMzQ2MjY2Mzc2MjYyMzczNzMwMzM2MzM3NjM2NTMzMzU2NDYzNjI2NDYyMzUzMzM0NjU2NTYzNjQ2MzMyNjIzODMwNjEzNzYzNjQzOTM0MzU2NDYzNjMzOTM1MzkzOTM0MzQzNDY1MzY2MzM4MzY2MzMyMzU2NjM4NjM2MjM1NjEzMjMxMzkzMzMzNjEzOTM5MzMzODYxMzY2MzMxNjI2NDMwMzg2NTM1MzkzMTM2NjI2MjMxNjY2NTM2MzIzNjYzNjYzNDY2NjM2NDMyMzEzMjMzNjM2MTM1MzkzNTYyMzkzNjMxMzAzNzMyMzgzMTYzMzkzNTYxMzc2MTY1MzAzMzY2NjIzNjMwNjM2MjY2MzE2MjMyMzIzNTY0MzUzMTMzMzAzNzMwMjIyYzIyNmQ2MTYzMjIzYTIyNjM2MzY2MzQ2NTYxNjQ2NTM4MzMzMTM0MzA2MzMxMzAzNjM0MzEzMDMyNjI2NTMyMzA2MzY1MzM2NDY0MzEzMDYyMzM2NDM3NjIzMjMxMzg2MjM4NjQzODM3MzgzNzYzMzk2NTY0Mzc2NDYxNjIzMDYzMzQzNTM5MzAzMDM3MzkyMjJjMjI3NzYxNzM1Mzc0NzI2OTZlNjcyMjNhNzQ3Mjc1NjU3ZCIsInB1YmxpY19rZXlzIjpbIjAzOWJlYzg2OTEwZWJmZWYwZThmYTdiYTY5NDUxZTVmOWM0NTU2OGZkMWEyZjgwNDkzMzYxYWUzNTM4YzY3ZjdiYiJdLCJwcm9maWxlIjpudWxsLCJ1c2VybmFtZSI6InN3MjAyMHRlc3R1c2VyMS5pZC5ibG9ja3N0YWNrIiwiY29yZV90b2tlbiI6bnVsbCwiZW1haWwiOm51bGwsInByb2ZpbGVfdXJsIjoiaHR0cHM6Ly9nYWlhLmJsb2Nrc3RhY2sub3JnL2h1Yi8xNGdTeHhYWXc5V20zaGFqMWhlSmF0NWRnaXhxdGFSd2tzL3Byb2ZpbGUuanNvbiIsImh1YlVybCI6Imh0dHBzOi8vaHViLmJsb2Nrc3RhY2sub3JnIiwiYmxvY2tzdGFja0FQSVVybCI6Imh0dHBzOi8vY29yZS5ibG9ja3N0YWNrLm9yZyIsImFzc29jaWF0aW9uVG9rZW4iOiJleUowZVhBaU9pSktWMVFpTENKaGJHY2lPaUpGVXpJMU5rc2lmUS5leUpqYUdsc1pGUnZRWE56YjJOcFlYUmxJam9pTURJME1tRXpOR0ZpTTJFeFpUUmtabU5pTXpjd056QTFZelUyTVdNelpEVXdPV0prTURneU16Vm1NVGRpWmpReFpEZzFPRFJrWkRNM01EZGpaVEkyWkdVeUlpd2lhWE56SWpvaU1ETTVZbVZqT0RZNU1UQmxZbVpsWmpCbE9HWmhOMkpoTmprME5URmxOV1k1WXpRMU5UWTRabVF4WVRKbU9EQTBPVE16TmpGaFpUTTFNemhqTmpkbU4ySmlJaXdpWlhod0lqb3hOakl5TnpZeE1qTXlMakF5TENKcFlYUWlPakUxT1RFeU1qVXlNekl1TURJc0luTmhiSFFpT2lKaFl6RTFaR1EwWWpKbE5HRTJOVFkwT0Roa05qUXhZVFExTm1NMllqVTVOeUo5LkRXbl9kNVBmQ0NxVmRnMUV2Rl9velNULXlCRFcwcGFVWXFwZGYxbjZ1WGpZY0xOUmUzQW1FSGtDSTZLWS0xTVNQWG05SUljZmlZb1Mtd0JpWXV4d05nIiwidmVyc2lvbiI6IjEuMy4xIn0.PljXRkEKvUHIZJwll4CVBgGfVrfSaxltRo47dHEiJHmCVuYwGiTii" \
          "hZShJLjS5URoh_TUpdLMlH1ookLjF4Ehw"

# sw2020testuser2.id.blockstack
TOKEN_2 = "eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NksifQ.eyJqdGkiOiIxZjJiYzcyNy03Y2ZhLTQ5NDEtOTk4ZC03YjIyMGEwOTg2NmYiLCJpYXQiOjE1OTEyMjU0OTYsImV4cCI6MTYyNTM1MzQ5NiwiaXNzIjoiZGlkOmJ0Yy1hZGRyOjFIMlQxY0Rmd3lZZFlra1pFUkhmQUh4SkJxaDNieTlWd2kiLCJwcml2YXRlX2tleSI6IjdiMjI2OTc2MjIzYTIyMzAzMTMxMzIzNTY0MzMzMzM1MzMzNDYxNjYzMDM0MzE2NTM1MzczNDMyMzczMjMwNjU2MzM0Mzk2MzMwMzY2NjIyMmMyMjY1NzA2ODY1NmQ2NTcyNjE2YzUwNGIyMjNhMjIzMDMzMzQ2MzM4MzgzNzM4MzczNTM1MzAzMjM2MzI2MTM3MzI2NjMyNjE2MzY0MzUzMTMxNjY2NjM5MzczNTM3NjMzMTYzNjU2NDM3NjUzNjY2NjU2MjMzNjYzOTMyMzQzNTY0MzQ2NjMxNjIzMjYxMzE2MTM0Mzk2MzM0MzMzNjMxMzAyMjJjMjI2MzY5NzA2ODY1NzI1NDY1Nzg3NDIyM2EyMjM5NjYzNzY0MzMzNTM0NjQ2NTM3MzAzNjYzMzM2NjY0MzMzODM0MzAzNTY2MzUzOTY1NjMzODM5MzAzMTM3MzIzMjMwMzE2NDY2MzEzMTYzMzc2NTM4MzczMzM4NjUzNzY1MzA2NjMyNjUzNzY1MzM2MjM1NjQzOTMzNjE2MTMxNjQ2MzYyMzgzNDYzMzA2NTM2NjY2NDYyNjY2MTM2NjIzMDMyNjEzNTMzMzYzMTY2NjYzODYzNjUzMjYxNjQ2MTYyNjYzMjM5MzM2NTMzMzEzOTM0MzQzOTM5NjM2NDYzNjQzNDMxNjQzMjY2MzkzMjM4MzA2MzY1MzEzNDY2NjEzOTYzNjE2MzY0NjYzNzM1NjUzNzMwNjM2NjYzNjY2MzYxNjQzNDY1MzgzMjM4NjQzNjMwMzAzNzM0NjQ2MTM4MjIyYzIyNmQ2MTYzMjIzYTIyMzczMDMwNjMzMjY1MzgzMjMzMzE2MzM2NjIzNTYzMzM2MjYxNjIzMTYzMzczNTM2MzUzNjM1NjE2NDYzMzU2MjYxNjYzMzMxMzczODY0MzY2MTYxMzEzNTM4MzUzNjY2MzkzNDM3MzA2MzYzNjM2MzY2NjYzOTMwMzUzNjM2NjMyMjJjMjI3NzYxNzM1Mzc0NzI2OTZlNjcyMjNhNzQ3Mjc1NjU3ZCIsInB1YmxpY19rZXlzIjpbIjAzODM0YTYxMjc1NzQ3OGIyOWEwZTRmMDE1N2IyNzBhOTc5NTM3NzUxNWE2MmQwYTYzYTI1ZDU2MGYwODE4ZTk1YiJdLCJwcm9maWxlIjpudWxsLCJ1c2VybmFtZSI6InN3MjAyMHRlc3R1c2VyMi5pZC5ibG9ja3N0YWNrIiwiY29yZV90b2tlbiI6bnVsbCwiZW1haWwiOm51bGwsInByb2ZpbGVfdXJsIjoiaHR0cHM6Ly9nYWlhLmJsb2Nrc3RhY2sub3JnL2h1Yi8xSDJUMWNEZnd5WWRZa2taRVJIZkFIeEpCcWgzYnk5VndpL3Byb2ZpbGUuanNvbiIsImh1YlVybCI6Imh0dHBzOi8vaHViLmJsb2Nrc3RhY2sub3JnIiwiYmxvY2tzdGFja0FQSVVybCI6Imh0dHBzOi8vY29yZS5ibG9ja3N0YWNrLm9yZyIsImFzc29jaWF0aW9uVG9rZW4iOiJleUowZVhBaU9pSktWMVFpTENKaGJHY2lPaUpGVXpJMU5rc2lmUS5leUpqYUdsc1pGUnZRWE56YjJOcFlYUmxJam9pTURNd1lUY3dPV1E1WVRFMk1tUXdaV0kxTmpsbFltRTFZbVExTUdNeE0yWTJOak00T0RFNE9UbG1OV1ZrT1RBMVlXUmxNamcwWm1JNVpXUTFOemRpTnpZM0lpd2lhWE56SWpvaU1ETTRNelJoTmpFeU56VTNORGM0WWpJNVlUQmxOR1l3TVRVM1lqSTNNR0U1TnprMU16YzNOVEUxWVRZeVpEQmhOak5oTWpWa05UWXdaakE0TVRobE9UVmlJaXdpWlhod0lqb3hOakl5TnpZeE5EazJMak0zTVN3aWFXRjBJam94TlRreE1qSTFORGsyTGpNM01Td2ljMkZzZENJNklqY3paR0ZqTVdZMU9UVXhZbU0wWmpNeVl6UTBNamN5TXpKallUUmhORGN4SW4wLkxvZlFacFlSaktxd0tuOXQ2VFNEdGVlUUxWSlYyZzA1Nm9NVXBVSEtQUXUxSGg4TGlUU29JaUNBV05qbV9idTJhYmNVLThla2dpUU5NUy15VUVVRUVBIiwidmVyc2lvbiI6IjEuMy4xIn0.BhUkt3dAOPkO9xiHAflynVuAtmyoSVGb4TUxFlNhL-6Mc4sVw" \
          "N1yiP2_cyxJlzKBeYumqtNLnWTmlOV8XhrtXQ"


TOKEN_3 = "eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NksifQ.eyJqdGkiOiJjMzkyYmM2Mi1kMWIyLTRmNTQtYTM0OS0zNmFkNGNmNjZkN2UiLCJpYXQiOjE1OTE4MjQxOTcsImV4cCI6MTYyNTk1MjE5NywiaXNzIjoiZGlkOmJ0Yy1hZGRyOjFEb2ZMWkxkcnRSODV5MzlmSzZiUHplWXJjdG5tWDNiQmYiLCJwcml2YXRlX2tleSI6IjdiMjI2OTc2MjIzYTIyMzIzNDMxNjY2MzM5NjQ2MzM5MzA2NTM1MzYzOTYyMzEzODMzNjMzMTMxNjU2MTM3Mzc2NjMzMzYzNzM0NjM2NDIyMmMyMjY1NzA2ODY1NmQ2NTcyNjE2YzUwNGIyMjNhMjIzMDMyMzk2NjMxMzYzNDM1MzQzNjM1NjY2NTM5MzQ2NDMwMzkzMjMzNjMzMjM1MzUzNjM5MzU2MTM3NjM2NjM4NjY2MzM1MzYzNDMwMzkzOTM4MzgzMjM1NjIzNzM1MzU2NTYxMzI2MjM0Mzk2MzM1NjQ2NDMyNjMzODMzMzczNDYyMzEyMjJjMjI2MzY5NzA2ODY1NzI1NDY1Nzg3NDIyM2EyMjMxMzgzMDM5MzMzMDYxMzAzNDYxNjMzNTM4MzYzNDY2NjQ2MTM2MzAzNzY1NjIzOTYyMzMzMDYxMzczODM0MzMzMDMyNjU2MzMyMzU2NTM4NjYzMzMwNjUzMzMwNjYzNjM4MzI2NTY1MzgzNjYzMzgzMzM1MzczMzM1NjQ2NjYzMzczODYyMzg2NTYyNjIzMjM2NjUzNzY1MzIzMzM4MzMzMTM1MzczMTYyNjQ2NDM0NjIzMTYzMzYzMjMyNjYzMTYzMzYzNjY1MzY2NTM0NjIzNjMyMzQzNzMyNjQzOTMyMzM2MTY1MzkzNzYzMzYzMDM2MzgzMTY1MzY2MzY2NjUzODM5MzU2NDMxNjYzNDMzNjE2NjM2MzAzODY2MzIzODMxMzczNzY2MzQzMDY2NjYzMTYzMzYzMDM0MzE2MzMxMjIyYzIyNmQ2MTYzMjIzYTIyMzgzMDYxNjUzMDM5NjMzMzY2NjQ2MjM5NjI2NDM2MzczNzMyNjYzMzMyMzEzODMyNjYzMDM5Mzg2MzMxMzYzNTYzNjMzODM1MzEzMjM3NjMzNTYzMzA2MjY2NjEzNDY2NjY2MzY0MzgzMjYxMzg2MTMwNjE2NjM3MzAzMDYzNjEyMjJjMjI3NzYxNzM1Mzc0NzI2OTZlNjcyMjNhNzQ3Mjc1NjU3ZCIsInB1YmxpY19rZXlzIjpbIjAyM2UwYmNkM2ZkNDMxOGY1MjViMDBmMGExODJlMjViZDE2ZTUzY2U2ZmM2ZTE5YWFmOThiNzUyNTkyYWZjNjdmZCJdLCJwcm9maWxlIjpudWxsLCJ1c2VybmFtZSI6InN3MjAyMHRlc3R1c2VyMTMzNy5pZC5ibG9ja3N0YWNrIiwiY29yZV90b2tlbiI6bnVsbCwiZW1haWwiOm51bGwsInByb2ZpbGVfdXJsIjoiaHR0cHM6Ly9nYWlhLmJsb2Nrc3RhY2sub3JnL2h1Yi8xRG9mTFpMZHJ0Ujg1eTM5Zks2YlB6ZVlyY3RubVgzYkJmL3Byb2ZpbGUuanNvbiIsImh1YlVybCI6Imh0dHBzOi8vaHViLmJsb2Nrc3RhY2sub3JnIiwiYmxvY2tzdGFja0FQSVVybCI6Imh0dHBzOi8vY29yZS5ibG9ja3N0YWNrLm9yZyIsImFzc29jaWF0aW9uVG9rZW4iOiJleUowZVhBaU9pSktWMVFpTENKaGJHY2lPaUpGVXpJMU5rc2lmUS5leUpqYUdsc1pGUnZRWE56YjJOcFlYUmxJam9pTURObE5EWXlZV1F4TldNeU1ETXlOekU1T1RSaE9UaGtZVEExWkRjeFlqQmxPRFV5TWpFME1tRTBZbU5sWm1ZM05EYzBNemRqWW1RMFpXVTVNMkl3WWpJeElpd2lhWE56SWpvaU1ESXpaVEJpWTJRelptUTBNekU0WmpVeU5XSXdNR1l3WVRFNE1tVXlOV0prTVRabE5UTmpaVFptWXpabE1UbGhZV1k1T0dJM05USTFPVEpoWm1NMk4yWmtJaXdpWlhod0lqb3hOakl6TXpZd01UazNMamd6T1N3aWFXRjBJam94TlRreE9ESTBNVGszTGpnek9Td2ljMkZzZENJNklqQmlOalpqWXpJMk9EY3pZamhtTldGa09XSXpOR0k0WlRKallXUTBPR1V5SW4wLlVUT2JDUTFEaTVIVWpwV29CckpFTl9SNm9rM2p5WmphRTlRcXUxVHRwWmJkNTlMNDBWcW11SEZQRWlyLXhCQU5xYldpYzRvZVdaRHhiUENxeEFjTXJBIiwidmVyc2lvbiI6IjEuMy4xIn0.uloLYcJbfx1l56Sqi9EwjxQ_s3mtw1sudLKTMxr7ko0Ho" \
          "wQFY6LUW-G3GXS6eTng2kpYblk50G5qnfxL_cDjjQ"


TOKEN_INVALID_USER = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIyNGE1OTFkNS1lOGJiLTQwMzYtYWE0Ni1hNzg5MjU2ZDVjZDYiLCJpYXQiOjE1OTEyMjUyMzIsImV4cCI6MTYyNTM1MzIzMiwiaXNzIjoiZGlkOmJ0Yy1hZGRyOjE0Z1N4eFhZdzlXbTNoYWoxaGVKYXQ1ZGdpeHF0YVJ3a3MiLCJwdWJsaWNfa2V5cyI6WyIwMzliZWM4NjkxMGViZmVmMGU4ZmE3YmE2OTQ1MWU1ZjljNDU1NjhmZDFhMmY4MDQ5MzM2MWFlMzUzOGM2N2Y3YmIiXSwidXNlcm5hbWUiOiJpbnZhbGlkX3VzZXIuaWQuYmxvY2tzdGFjayIsImNvcmVfdG9rZW4iOm51bGwsImVtYWlsIjpudWxsLCJwcm9maWxlX3VybCI6Imh0dHBzOi8vZ2FpYS5ibG9ja3N0YWNrLm9yZy9odWIvMTRnU3h4WFl3OVdtM2hhajFoZUphdDVkZ2l4cXRhUndrcy9wcm9maWxlLmpzb24iLCJodWJVcmwiOiJodHRwczovL2h1Yi5ibG9ja3N0YWNrLm9yZyIsImJsb2Nrc3RhY2tBUElVcmwiOiJodHRwczovL2NvcmUuYmxvY2tzdGFjay5vcmciLCJ2ZXJzaW9uIjoiMS4zLjEifQ.zi4fcEK0yRmpUawVlcw6INSeUhCWzE7vF6RkA02Wn5w"

TOKEN_INVALID_EXP = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIyNGE1OTFkNS1lOGJiLTQwMzYtYWE0Ni1hNzg5MjU2ZDVjZDYiLCJpYXQiOjE1OTEyMjUyMzIsImV4cCI6MTU2NTc0MDgwMCwiaXNzIjoiZGlkOmJ0Yy1hZGRyOjE0Z1N4eFhZdzlXbTNoYWoxaGVKYXQ1ZGdpeHF0YVJ3a3MiLCJwdWJsaWNfa2V5cyI6WyIwMzliZWM4NjkxMGViZmVmMGU4ZmE3YmE2OTQ1MWU1ZjljNDU1NjhmZDFhMmY4MDQ5MzM2MWFlMzUzOGM2N2Y3YmIiXSwidXNlcm5hbWUiOiJzdzIwMjB0ZXN0dXNlcjEuaWQuYmxvY2tzdGFjayIsImNvcmVfdG9rZW4iOm51bGwsImVtYWlsIjpudWxsLCJwcm9maWxlX3VybCI6Imh0dHBzOi8vZ2FpYS5ibG9ja3N0YWNrLm9yZy9odWIvMTRnU3h4WFl3OVdtM2hhajFoZUphdDVkZ2l4cXRhUndrcy9wcm9maWxlLmpzb24iLCJodWJVcmwiOiJodHRwczovL2h1Yi5ibG9ja3N0YWNrLm9yZyIsImJsb2Nrc3RhY2tBUElVcmwiOiJodHRwczovL2NvcmUuYmxvY2tzdGFjay5vcmciLCJ2ZXJzaW9uIjoiMS4zLjEifQ.UE0Bte0fWeSGOZL7A6RDeW4KaGtY5bosQzzenYiDKfA"

TOKEN_INVALID_IAT = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIyNGE1OTFkNS1lOGJiLTQwMzYtYWE0Ni1hNzg5MjU2ZDVjZDYiLCJpYXQiOjE2Mjg4OTkyMDAsImV4cCI6MTYyNTM1MzIzMiwiaXNzIjoiZGlkOmJ0Yy1hZGRyOjE0Z1N4eFhZdzlXbTNoYWoxaGVKYXQ1ZGdpeHF0YVJ3a3MiLCJwdWJsaWNfa2V5cyI6WyIwMzliZWM4NjkxMGViZmVmMGU4ZmE3YmE2OTQ1MWU1ZjljNDU1NjhmZDFhMmY4MDQ5MzM2MWFlMzUzOGM2N2Y3YmIiXSwidXNlcm5hbWUiOiJzdzIwMjB0ZXN0dXNlcjEuaWQuYmxvY2tzdGFjayIsImNvcmVfdG9rZW4iOm51bGwsImVtYWlsIjpudWxsLCJwcm9maWxlX3VybCI6Imh0dHBzOi8vZ2FpYS5ibG9ja3N0YWNrLm9yZy9odWIvMTRnU3h4WFl3OVdtM2hhajFoZUphdDVkZ2l4cXRhUndrcy9wcm9maWxlLmpzb24iLCJodWJVcmwiOiJodHRwczovL2h1Yi5ibG9ja3N0YWNrLm9yZyIsImJsb2Nrc3RhY2tBUElVcmwiOiJodHRwczovL2NvcmUuYmxvY2tzdGFjay5vcmciLCJ2ZXJzaW9uIjoiMS4zLjEifQ.LJlhK2Ghu_Uva81pYd1brLlPPFQOEQcYmIdiwUAkpJQ"

TOKEN_INVALID_PK = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIyNGE1OTFkNS1lOGJiLTQwMzYtYWE0Ni1hNzg5MjU2ZDVjZDYiLCJpYXQiOjE1OTEyMjUyMzIsImV4cCI6MTYyNTM1MzIzMiwiaXNzIjoiZGlkOmJ0Yy1hZGRyOjE0Z1N4eFhZdzlXbTNoYWoxaGVKYXQ1ZGdpeHF0YVJ3a3MiLCJwdWJsaWNfa2V5cyI6WyIwMzlhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWE1ZjljNDU1NjhmZDFhMmY4MDQ5MzM2MWFlMzUzOGM2N2Y3YmIiXSwidXNlcm5hbWUiOiJzdzIwMjB0ZXN0dXNlcjEuaWQuYmxvY2tzdGFjayIsImNvcmVfdG9rZW4iOm51bGwsImVtYWlsIjpudWxsLCJwcm9maWxlX3VybCI6Imh0dHBzOi8vZ2FpYS5ibG9ja3N0YWNrLm9yZy9odWIvMTRnU3h4WFl3OVdtM2hhajFoZUphdDVkZ2l4cXRhUndrcy9wcm9maWxlLmpzb24iLCJodWJVcmwiOiJodHRwczovL2h1Yi5ibG9ja3N0YWNrLm9yZyIsImJsb2Nrc3RhY2tBUElVcmwiOiJodHRwczovL2NvcmUuYmxvY2tzdGFjay5vcmciLCJ2ZXJzaW9uIjoiMS4zLjEifQ.J0S87pn-fVZcuyl6JrUudXWOndxXzUbSJK4uar5JOrE"

TOKEN_INVALID_ISS = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIyNGE1OTFkNS1lOGJiLTQwMzYtYWE0Ni1hNzg5MjU2ZDVjZDYiLCJpYXQiOjE1OTEyMjUyMzIsImV4cCI6MTYyNTM1MzIzMiwiaXNzIjoiZGlkOmV0aC1hZGRyOjE0Z1N4eFhZdzlXbTNoYWoxaGVKYXQ1ZGdpeHF0YVJ3a3MiLCJwdWJsaWNfa2V5cyI6WyIwMzliZWM4NjkxMGViZmVmMGU4ZmE3YmE2OTQ1MWU1ZjljNDU1NjhmZDFhMmY4MDQ5MzM2MWFlMzUzOGM2N2Y3YmIiXSwidXNlcm5hbWUiOiJzdzIwMjB0ZXN0dXNlcjEuaWQuYmxvY2tzdGFjayIsImNvcmVfdG9rZW4iOm51bGwsImVtYWlsIjpudWxsLCJwcm9maWxlX3VybCI6Imh0dHBzOi8vZ2FpYS5ibG9ja3N0YWNrLm9yZy9odWIvMTRnU3h4WFl3OVdtM2hhajFoZUphdDVkZ2l4cXRhUndrcy9wcm9maWxlLmpzb24iLCJodWJVcmwiOiJodHRwczovL2h1Yi5ibG9ja3N0YWNrLm9yZyIsImJsb2Nrc3RhY2tBUElVcmwiOiJodHRwczovL2NvcmUuYmxvY2tzdGFjay5vcmciLCJ2ZXJzaW9uIjoiMS4zLjEifQ.eRup8Z3RPPFsG0iEWNQRyWEzNQUdLdXa24C0QgzCNvs"

TOKEN_INVALID_ISS2 = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIyNGE1OTFkNS1lOGJiLTQwMzYtYWE0Ni1hNzg5MjU2ZDVjZDYiLCJpYXQiOjE1OTEyMjUyMzIsImV4cCI6MTYyNTM1MzIzMiwiaXNzIjoiZGlkOmJ0Yy1hZGRyOjE0YWFhYWFhYWFhYWFhYWFhYWFKYXQ1ZGdpeHF0YVJ3a3MiLCJwdWJsaWNfa2V5cyI6WyIwMzliZWM4NjkxMGViZmVmMGU4ZmE3YmE2OTQ1MWU1ZjljNDU1NjhmZDFhMmY4MDQ5MzM2MWFlMzUzOGM2N2Y3YmIiXSwidXNlcm5hbWUiOiJzdzIwMjB0ZXN0dXNlcjEuaWQuYmxvY2tzdGFjayIsImNvcmVfdG9rZW4iOm51bGwsImVtYWlsIjpudWxsLCJwcm9maWxlX3VybCI6Imh0dHBzOi8vZ2FpYS5ibG9ja3N0YWNrLm9yZy9odWIvMTRnU3h4WFl3OVdtM2hhajFoZUphdDVkZ2l4cXRhUndrcy9wcm9maWxlLmpzb24iLCJodWJVcmwiOiJodHRwczovL2h1Yi5ibG9ja3N0YWNrLm9yZyIsImJsb2Nrc3RhY2tBUElVcmwiOiJodHRwczovL2NvcmUuYmxvY2tzdGFjay5vcmciLCJ2ZXJzaW9uIjoiMS4zLjEifQ.h8ebhw78ikxgU_Xrf-wbj0ZdM8NnYPLC-xAmVszxIuU"


def test_username1():
    assert BlockstackAuth.get_username_from_token(TOKEN_1) == "sw2020testuser1.id.blockstack"


def test_username2():
    assert BlockstackAuth.get_username_from_token(TOKEN_2) == "sw2020testuser2.id.blockstack"


def test_shorten1():
    assert len(BlockstackAuth.short_jwt(TOKEN_1)) < len(TOKEN_1)


def test_shorten2():
    assert len(BlockstackAuth.short_jwt(TOKEN_2)) < len(TOKEN_2)


def test_verify_valid1():
    assert BlockstackAuth.verify_auth_response(TOKEN_1)


def test_verify_valid2():
    assert BlockstackAuth.verify_auth_response(TOKEN_2)


def test_verify_valid3():
    assert BlockstackAuth.verify_auth_response(TOKEN_3)


def test_verify_invalid1():
    assert not BlockstackAuth.verify_auth_response(TOKEN_INVALID_USER)


def test_verify_invalid2():
    assert not BlockstackAuth.verify_auth_response(TOKEN_INVALID_EXP)


def test_verify_invalid3():
    assert not BlockstackAuth.verify_auth_response(TOKEN_INVALID_IAT)


def test_verify_invalid4():
    assert not BlockstackAuth.verify_auth_response(TOKEN_INVALID_PK)


def test_verify_invalid5():
    assert not BlockstackAuth.verify_auth_response(TOKEN_INVALID_ISS)


def test_verify_invalid6():
    assert not BlockstackAuth.verify_auth_response(TOKEN_INVALID_ISS2)


def test_verify_no_token():
    with pytest.raises(DecodeError):
        BlockstackAuth.verify_auth_response("")


def test_verify_no_token2():
    with pytest.raises(DecodeError):
        BlockstackAuth.verify_auth_response("test")
